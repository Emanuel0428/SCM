---
import Layout from '../layouts/Layout.astro';
import InventarioCRUD from '../components/InventarioCRUD.astro';
import MovimientoCRUD from '../components/MovimientoCRUD.astro';
import ControlInventario from '../components/ControlInventario.astro';
---
<Layout>
  <div class="flex flex-col items-center w-full">
    <h1 class="text-3xl font-extrabold mb-6 text-blue-900 text-center drop-shadow">Gestión de Inventario</h1>
    
    <div class="w-full mb-6">
      <div class="sm:hidden">
        <label for="tabs" class="sr-only">Seleccionar vista</label>
        <select id="tabs" name="tabs" class="block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500">
          <option>Activos</option>
          <option>Movimientos</option>
          <option>Control inventario</option>
        </select>
      </div>
      <div class="hidden sm:block">
        <div class="border-b border-gray-200">
          <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button
              class="border-blue-500 text-blue-600 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium"
              aria-current="page"
              id="tab-activos"
            >
              Activos
            </button>
            <button
              class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium"
              id="tab-movimientos"
            >
              Movimientos
            </button>
            <button
              class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium"
              id="tab-control"
            >
              Control inventario
            </button>
          </nav>
        </div>
      </div>
    </div>

    <div class="w-full gap-8 mb-10">
      <div id="panel-activos">
        <InventarioCRUD />
      </div>
      <div id="panel-movimientos" class="hidden">
        <MovimientoCRUD />
      </div>
      <div id="panel-control" class="hidden">
        <ControlInventario />
      </div>
    </div>
  </div>
</Layout>

<script>
  // Manejo de pestañas
  const tabActivos = document.getElementById('tab-activos');
  const tabMovimientos = document.getElementById('tab-movimientos');
  const tabControl = document.getElementById('tab-control');
  const panelActivos = document.getElementById('panel-activos');
  const panelMovimientos = document.getElementById('panel-movimientos');
  const panelControl = document.getElementById('panel-control');
  const tabSelect = document.querySelector('select#tabs');

  function resetTabStyles() {
    [tabActivos, tabMovimientos, tabControl].forEach(t => {
      if (!t) return;
      t.classList.remove('border-blue-500', 'text-blue-600');
      t.classList.add('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
    });
  }

  function hideAllPanels() {
    panelActivos?.classList.add('hidden');
    panelMovimientos?.classList.add('hidden');
    panelControl?.classList.add('hidden');
  }

  function showTab(tab) {
    resetTabStyles();
    hideAllPanels();
    if (tab === 'activos') {
      tabActivos?.classList.add('border-blue-500', 'text-blue-600');
      panelActivos?.classList.remove('hidden');
    } else if (tab === 'movimientos') {
      tabMovimientos?.classList.add('border-blue-500', 'text-blue-600');
      panelMovimientos?.classList.remove('hidden');
    } else if (tab === 'control') {
      tabControl?.classList.add('border-blue-500', 'text-blue-600');
      panelControl?.classList.remove('hidden');
    }
  }

  tabActivos?.addEventListener('click', () => {
    showTab('activos');
    const select = document.querySelector('select#tabs');
    if (select) select.value = 'Activos';
  });

  tabMovimientos?.addEventListener('click', () => {
    showTab('movimientos');
    const select = document.querySelector('select#tabs');
    if (select) select.value = 'Movimientos';
  });

  tabControl?.addEventListener('click', () => {
    showTab('control');
    const select = document.querySelector('select#tabs');
    if (select) select.value = 'Control inventario';
  });

  // Manejar el select en móvil
  tabSelect?.addEventListener('change', (event) => {
    const target = event.target;
    const val = target.value;
    if (val === 'Activos') showTab('activos');
    else if (val === 'Movimientos') showTab('movimientos');
    else if (val === 'Control inventario') showTab('control');
  });

  // Inicializar mostrando Activos
  document.addEventListener('DOMContentLoaded', () => showTab('activos'));
</script>
